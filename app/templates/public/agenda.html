{% extends "base.html" %}
{% block content %}
<div class="min-h-screen flex items-center justify-center bg-slate-200 p-4">
    <div class="w-full max-w-md bg-white shadow-2xl overflow-hidden">
        <div class="bg-slate-900 p-10 text-center border-b-4 border-indigo-600">
            <span class="block text-xs font-bold text-indigo-400 uppercase tracking-[0.2em] mb-2">Reserva Profesional</span>
            <h1 class="text-3xl font-bold text-white tracking-tight">{{ professional.name }}</h1>
        </div>
        <div class="p-8 space-y-6 bg-white">
            <form action="{{ url_for('public.agenda', slug=professional.slug) }}" method="POST" class="space-y-5">
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-500 mb-2 tracking-wide">Nombre Completo</label>
                    <input type="text" name="name" required class="block w-full px-0 py-3 text-slate-900 bg-transparent border-0 border-b-2 border-slate-200 focus:border-indigo-600 focus:ring-0 text-lg transition">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-500 mb-2 tracking-wide">Teléfono</label>
                    <input type="tel" name="phone" required class="block w-full px-0 py-3 text-slate-900 bg-transparent border-0 border-b-2 border-slate-200 focus:border-indigo-600 focus:ring-0 text-lg transition">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-500 mb-2 tracking-wide">Día</label>
                    <select name="date" id="date-select" required class="block w-full px-0 py-3 text-slate-900 bg-transparent border-0 border-b-2 border-slate-200 focus:border-indigo-600 focus:ring-0 text-lg transition cursor-pointer">
                        <option value="" disabled selected>Seleccionar fecha</option>
                        {% for d in enabled_dates %}
                        <option value="{{ d.date }}">{{ d.date|format_date }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div id="slots-container" class="hidden">
                    <label class="block text-xs font-bold uppercase text-slate-500 mb-3 tracking-wide">Horarios Disponibles</label>
                    <div id="slots-grid" class="grid grid-cols-3 gap-2"></div>
                    <input type="hidden" name="time_slot" id="time-slot-input">
                </div>
                <button type="submit" id="submit-btn" class="w-full bg-indigo-600 text-white py-4 rounded text-sm font-bold uppercase tracking-widest hover:bg-indigo-700 transition mt-8 shadow-lg shadow-indigo-600/20 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Confirmar Reserva
                </button>
            </form>
        </div>
    </div>
</div>
<script>
document.getElementById('date-select').addEventListener('change', function() {
    const date = this.value;
    const slug = "{{ professional.slug }}";
    const container = document.getElementById('slots-container');
    const grid = document.getElementById('slots-grid');
    const submitBtn = document.getElementById('submit-btn');
    
    grid.innerHTML = '<p class="col-span-3 text-center text-slate-400 text-sm">Cargando...</p>';
    container.classList.remove('hidden');
    submitBtn.disabled = true;
    document.getElementById('time-slot-input').value = "";

    fetch(`/agenda/get-slots/${slug}/${date}`)
        .then(response => response.json())
        .then(data => {
            grid.innerHTML = '';
            if(data.slots && data.slots.length > 0){
                data.slots.forEach(slot => {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.innerText = slot;
                    btn.className = 'border border-slate-300 rounded py-2 text-sm font-medium hover:bg-indigo-50 hover:border-indigo-500 hover:text-indigo-600 transition';
                    btn.onclick = function() {
                        document.querySelectorAll('#slots-grid button').forEach(b => b.classList.remove('bg-indigo-600', 'text-white', 'border-indigo-600'));
                        this.classList.add('bg-indigo-600', 'text-white', 'border-indigo-600');
                        document.getElementById('time-slot-input').value = slot;
                        submitBtn.disabled = false;
                    };
                    grid.appendChild(btn);
                });
            } else {
                grid.innerHTML = '<p class="col-span-3 text-center text-red-500 text-sm">Sin horarios disponibles.</p>';
            }
        });
});
</script>
{% endblock %}
